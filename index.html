<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Wu(悟)Book - 错题本</title>
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <header class="app-header">
        <h1>Wu(悟)Book</h1>
        <p class="tagline">A light-weight error book to help your child grow through mistakes.</p>
    </header>

    <main class="layout" id="layout">
        <section class="panel" id="entry-panel" aria-labelledby="entry-form-title" hidden>
            <div class="panel-header">
                <div class="panel-header__top">
                    <h2 id="entry-form-title">新的错题</h2>
                    <a href="#" id="close-entry-panel" class="panel-link">返回错题列表</a>
                </div>
                <p>Add mistakes as they happen to keep everything organised.</p>
            </div>
            <form id="entry-form" class="form-grid">
                <label class="field">
                    <span>来源</span>
                    <input type="text" id="source" name="source" placeholder="教材、试卷等" />
                </label>
                <label class="field">
                    <span>学科</span>
                    <input type="text" id="subject" name="subject" list="subject-options" placeholder="数学、英语…" />
                </label>
                <label class="field">
                    <span>学期</span>
                    <select id="semester" name="semester">
                        <option value="">请选择</option>
                        <option value="八上">八上</option>
                        <option value="八下">八下</option>
                        <option value="九上">九上</option>
                        <option value="九下">九下</option>
                    </select>
                </label>
                <label class="field">
                    <span>题目类型</span>
                    <input type="text" id="question-type" name="questionType" placeholder="选择题、填空题…" />
                </label>
                <label class="field">
                    <span>创建日期</span>
                    <input type="date" id="created-at" name="createdAt" />
                </label>
                <label class="field field--span-2">
                    <span>错误原因</span>
                    <textarea id="error-reason" name="errorReason" rows="2" placeholder="粗心、概念模糊等"></textarea>
                </label>
                <label class="field field--span-2">
                    <span>题目内容（文字）</span>
                    <textarea id="question-text" name="questionText" rows="3" placeholder="输入题干文本"></textarea>
                </label>
                <label class="field">
                    <span>题目图片</span>
                    <input type="file" id="question-image" name="questionImage" accept="image/*" />
                    <small>可上传题干照片。</small>
                </label>
                <label class="field field--span-2">
                    <span>答案（文字）</span>
                    <textarea id="answer-text" name="answerText" rows="3" placeholder="输入正确答案或解析"></textarea>
                </label>
                <label class="field">
                    <span>答案图片</span>
                    <input type="file" id="answer-image" name="answerImage" accept="image/*" />
                    <small>可上传答案照片。</small>
                </label>
                <button type="submit" class="btn btn-primary field--span-2">保存</button>
            </form>

            <div class="panel-footer">
                <button id="export-btn" class="btn" disabled>导出选中（Word）</button>
                <label class="btn btn-secondary" for="import-input">Import Entries</label>
                <input type="file" id="import-input" accept="application/json" hidden />
                <button id="clear-btn" class="btn btn-danger">Clear All</button>
            </div>
        </section>

        <section class="panel" aria-labelledby="entries-title">
            <div class="panel-header">
                <div class="panel-header__top">
                    <h2 id="entries-title">错题库</h2>
                    <div class="panel-links">
                        <a href="#" id="open-entry-panel" class="panel-link" aria-controls="entry-panel" aria-expanded="false">新的错题</a>
                        <a href="#" id="open-log-panel" class="panel-link" aria-controls="log-panel" aria-expanded="false">查看活动日志</a>
                    </div>
                </div>
                <div class="filters">
                    <label>
                        <span>搜索</span>
                        <input type="search" id="search" placeholder="搜索题目、答案或原因" />
                    </label>
                    <label>
                        <span>题目类型</span>
                        <select id="type-filter">
                            <option value="">全部</option>
                        </select>
                    </label>
                    <label>
                        <span>学科</span>
                        <select id="subject-filter">
                            <option value="">全部</option>
                        </select>
                    </label>
                    <label>
                        <span>学期</span>
                        <select id="semester-filter">
                            <option value="">全部</option>
                        </select>
                    </label>
                    <label>
                        <span>来源</span>
                        <select id="source-filter">
                            <option value="">全部</option>
                        </select>
                    </label>
                    <label>
                        <span>错误原因</span>
                        <select id="error-reason-filter">
                            <option value="">全部</option>
                        </select>
                    </label>
                    <label>
                        <span>起始日期</span>
                        <input type="date" id="date-start" />
                    </label>
                    <label>
                        <span>结束日期</span>
                        <input type="date" id="date-end" />
                    </label>
                    <div class="filters__quick-links" role="group" aria-label="常用筛选">
                        <span>快捷：</span>
                        <a href="#" id="math-shortcut" class="filters__quick-link">数学</a>
                    </div>
                </div>
            </div>

            <div id="stats" class="stats" role="status" aria-live="polite"></div>
            <div class="selection-toolbar">
                <p id="selection-status" class="selection-status" role="status" aria-live="polite">No entries selected.</p>
                <div class="selection-toolbar__actions">
                    <button type="button" id="select-filtered-btn" class="btn btn-secondary btn-compact">Select Filtered</button>
                    <button type="button" id="clear-selection-btn" class="btn btn-secondary btn-compact" disabled>Clear Selection</button>
                </div>
            </div>
            <div id="entries" class="entries" aria-live="polite"></div>
        </section>

        <section class="panel panel--log" id="log-panel" aria-labelledby="activity-log-title" hidden>
            <div class="panel-header panel-header--log">
                <div>
                    <h2 id="activity-log-title">Activity Log</h2>
                    <p>Track uploads, edits, deletes, and imports in real time.</p>
                </div>
                <div class="log-controls">
                    <button id="refresh-log-btn" class="btn btn-secondary" type="button">Refresh log</button>
                    <span id="log-status" class="log-status" role="status" aria-live="polite"></span>
                    <a href="#" id="close-log-panel" class="panel-link panel-link--muted">返回错题列表</a>
                </div>
            </div>
            <ol id="activity-log" class="log-list" aria-live="polite"></ol>
        </section>
    </main>

    <template id="entry-template">
        <article class="entry-card" data-id="">
            <header class="entry-header">
                <div class="entry-select-area">
                    <input type="checkbox" class="entry-select-input" aria-label="Select entry" />
                </div>
                <div class="entry-header__details">
                    <h3 class="entry-title"></h3>
                    <p class="entry-meta"></p>
                </div>
                <menu class="entry-actions" aria-label="Entry actions">
                    <button class="btn-icon" data-action="similar" title="Find similar exercises">🔍</button>
                    <button class="btn-icon" data-action="edit" title="Edit">✏️</button>
                    <button class="btn-icon" data-action="delete" title="Delete">🗑️</button>
                </menu>
            </header>
            <section class="entry-content">
                <div class="entry-section entry-section--question">
                    <h4>题目</h4>
                    <p class="entry-question-text"></p>
                    <figure class="entry-question-image"></figure>
                </div>
                <div class="entry-section entry-section--answer">
                    <h4>答案</h4>
                    <p class="entry-answer-text"></p>
                    <figure class="entry-answer-image"></figure>
                </div>
                <p class="entry-error-reason"></p>
            </section>
            <footer class="entry-footer">
                <p class="entry-timestamp"></p>
                <div class="entry-similar" hidden>
                    <h4>Similar exercises</h4>
                    <ul></ul>
                </div>
            </footer>
        </article>
    </template>

    <dialog id="edit-dialog">
        <form method="dialog" id="edit-form" class="form-grid">
            <h2>Edit Entry</h2>
            <input type="hidden" id="edit-id" />
            <label class="field">
                <span>来源</span>
                <input type="text" id="edit-source" />
            </label>
            <label class="field">
                <span>学科</span>
                <input type="text" id="edit-subject" list="subject-options" />
            </label>
            <label class="field">
                <span>学期</span>
                <select id="edit-semester">
                    <option value="">请选择</option>
                    <option value="八上">八上</option>
                    <option value="八下">八下</option>
                    <option value="九上">九上</option>
                    <option value="九下">九下</option>
                </select>
            </label>
            <label class="field">
                <span>题目类型</span>
                <input type="text" id="edit-question-type" />
            </label>
            <label class="field field--span-2">
                <span>创建日期</span>
                <input type="date" id="edit-created-at" />
            </label>
            <label class="field field--span-2">
                <span>错误原因</span>
                <textarea id="edit-error-reason" rows="2"></textarea>
            </label>
            <label class="field field--span-2">
                <span>题目内容（文字）</span>
                <textarea id="edit-question-text" rows="3"></textarea>
            </label>
            <label class="field field--span-2">
                <span>答案（文字）</span>
                <textarea id="edit-answer-text" rows="3"></textarea>
            </label>
            <menu class="dialog-actions">
                <button value="cancel" class="btn">Cancel</button>
                <button value="confirm" class="btn btn-primary">Save changes</button>
            </menu>
        </form>
    </dialog>

    <dialog id="confirm-clear">
        <form method="dialog" class="confirm-dialog">
            <h2>Delete all entries?</h2>
            <p>This action will remove every saved mistake. You can export a backup before clearing.</p>
            <menu class="dialog-actions">
                <button value="cancel" class="btn">Cancel</button>
                <button value="confirm" class="btn btn-danger">Delete</button>
            </menu>
        </form>
    </dialog>

    <datalist id="subject-options">
        <option value="数学"></option>
        <option value="英语"></option>
        <option value="语文"></option>
        <option value="物理"></option>
        <option value="化学"></option>
        <option value="生物"></option>
        <option value="历史"></option>
        <option value="地理"></option>
        <option value="政治"></option>
        <option value="科学"></option>
    </datalist>

    <script src="app.js" type="module"></script>
</body>
</html>
